function jsonPath(obj,expr,arg){var P={resultType:arg&&arg.resultType||"VALUE",result:[],normalize:function(e){var t=[];return e.replace(/[\['](\??\(.*?\))[\]']/g,function(e,n){return"[#"+(t.push(n)-1)+"]"}).replace(/'?\.'?|\['?/g,";").replace(/;;;|;;/g,";..;").replace(/;$|'?\]|'$/g,"").replace(/#([0-9]+)/g,function(e,n){return t[n]})},asPath:function(e){for(var t=e.split(";"),n="$",i=1,a=t.length;a>i;i++)n+=/^[0-9*]+$/.test(t[i])?"["+t[i]+"]":"['"+t[i]+"']";return n},store:function(e,t){return e&&(P.result[P.result.length]="PATH"==P.resultType?P.asPath(e):t),!!e},trace:function(e,t,n){if(e){var i=e.split(";"),a=i.shift();if(i=i.join(";"),t&&t.hasOwnProperty(a))P.trace(i,t[a],n+";"+a);else if("*"===a)P.walk(a,i,t,n,function(e,t,n,i,a){P.trace(e+";"+n,i,a)});else if(".."===a)P.trace(i,t,n),P.walk(a,i,t,n,function(e,t,n,i,a){"object"==typeof i[e]&&P.trace("..;"+n,i[e],a+";"+e)});else if(/,/.test(a))for(var o=a.split(/'?,'?/),r=0,s=o.length;s>r;r++)P.trace(o[r]+";"+i,t,n);else/^\(.*?\)$/.test(a)?P.trace(P.eval(a,t,n.substr(n.lastIndexOf(";")+1))+";"+i,t,n):/^\?\(.*?\)$/.test(a)?P.walk(a,i,t,n,function(e,t,n,i,a){P.eval(t.replace(/^\?\((.*?)\)$/,"$1"),i[e],e)&&P.trace(e+";"+n,i,a)}):/^(-?[0-9]*):(-?[0-9]*):?([0-9]*)$/.test(a)&&P.slice(a,i,t,n)}else P.store(n,t)},walk:function(e,t,n,i,a){if(n instanceof Array)for(var o=0,r=n.length;r>o;o++)o in n&&a(o,e,t,n,i);else if("object"==typeof n)for(var s in n)n.hasOwnProperty(s)&&a(s,e,t,n,i)},slice:function(e,t,n,i){if(n instanceof Array){var a=n.length,o=0,r=a,s=1;e.replace(/^(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)$/g,function(e,t,n,i){o=parseInt(t||o),r=parseInt(n||r),s=parseInt(i||s)}),o=0>o?Math.max(0,o+a):Math.min(a,o),r=0>r?Math.max(0,r+a):Math.min(a,r);for(var p=o;r>p;p+=s)P.trace(p+";"+t,n,i)}},eval:function(x,_v,_vname){try{return $&&_v&&eval(x.replace(/@/g,"_v"))}catch(e){throw new SyntaxError("jsonPath: "+e.message+": "+x.replace(/@/g,"_v").replace(/\^/g,"_a"))}}},$=obj;return expr&&obj&&("VALUE"==P.resultType||"PATH"==P.resultType)?(P.trace(P.normalize(expr).replace(/^\$;/,""),obj,"$"),P.result.length?P.result:!1):void 0}!function($){jQuery.fn.yiiUploadKit=function(options){var $input=this,$container=$input.parent("div"),$files=$("<ul>",{"class":"files"}).insertBefore($input),$emptyInput=$container.find(".empty-value"),methods={init:function(){options.multiple&&($input.attr("multiple",!0),$input.attr("name",$input.attr("name")+"[]")),$container.addClass("upload-kit"),options.sortable&&$files.sortable({placeholder:"upload-kit-item sortable-placeholder",tolerance:"pointer",forcePlaceholderSize:!0,update:function(){methods.updateOrder()}}),$input.wrapAll($('<li class="upload-kit-input"></div>')).after($('<span class="glyphicon glyphicon-plus-sign add"></span>')).after($('<span class="glyphicon glyphicon-circle-arrow-down drag"></span>')).after($("<span/>",{"data-toggle":"popover","class":"glyphicon glyphicon-exclamation-sign error-popover"})).after('<div class="progress"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div></li>'),$files.on("click",".upload-kit-item .remove",methods.removeItem),methods.checkInputVisibility(),methods.fileuploadInit(),methods.dragInit(),!options.acceptFileTypes||options.acceptFileTypes instanceof RegExp||(options.acceptFileTypes=new RegExp(eval(options.acceptFileTypes)))},fileuploadInit:function(){var e=$input.fileupload({name:options.name||"file",url:options.url,dropZone:$input.parents(".upload-kit-input"),dataType:"json",singleFileUploads:!1,multiple:options.multiple,maxNumberOfFiles:options.maxNumberOfFiles,maxFileSize:options.maxFileSize,acceptFileTypes:options.acceptFileTypes,minFileSize:options.minFileSize,messages:options.messages,process:!0,getNumberOfFiles:methods.getNumberOfFiles,start:function(e,t){$container.find(".upload-kit-input").removeClass("error").addClass("in-progress"),$input.trigger("start"),void 0!==options.start&&options.start(e,t)},processfail:function(e,t){t.files.error&&methods.showError(t.files[0].error)},progressall:function(e,t){var n=parseInt(t.loaded/t.total*100,10);$container.find(".progress-bar").attr("aria-valuenow",n).css("width",n+"%").text(n+"%")},done:function(e,t){$.each(t.result.files,function(e,t){if(t.error)methods.showError(t.errors);else{var n=methods.createItem(t);n.appendTo($files)}}),methods.handleEmptyValue(),methods.checkInputVisibility(),$input.trigger("done"),void 0!==options.done&&options.done(e,t)},fail:function(e,t){methods.showError(t.errorThrown),void 0!==options.fail&&options.fail(e,t)},always:function(e,t){$container.find(".upload-kit-input").removeClass("in-progress"),$input.trigger("always"),void 0!==options.always&&options.always(e,t)}});options.files&&(options.files.sort(function(e,t){return parseInt(e.order)-parseInt(t.order)}),e.fileupload("option","done").call(e,$.Event("done"),{result:{files:options.files}}),methods.handleEmptyValue(),methods.checkInputVisibility())},dragInit:function(){$(document).on("dragover",function(){$(".upload-kit-input").addClass("drag-highlight")}),$(document).on("dragleave drop",function(){$(".upload-kit-input").removeClass("drag-highlight")})},showError:function(e){$.fn.popover&&$container.find(".error-popover").attr("data-content",e).popover({html:!0,trigger:"hover"}),$container.find(".upload-kit-input").addClass("error")},removeItem:function(e){var t=$(this),n=t.data("url");n&&$.ajax({url:n,type:"DELETE"}),t.parents(".upload-kit-item").remove(),methods.handleEmptyValue(),methods.checkInputVisibility()},getValue:function(e,t){var n=jsonPath(e,"$."+t);return n!==!1?n:void 0},createItem:function(e){var t=options.name,n=methods.getNewItemIndex();options.multiple&&(t+="["+n+"]");var i=$("<li>",{"class":"upload-kit-item done",value:n});if(i.append($("<input/>",{name:t+"["+options.pathAttributeName+"]",value:e[options.pathAttribute],type:"hidden"})).append($("<input/>",{name:t+"[name]",value:e.name,type:"hidden"})).append($("<input/>",{name:t+"[size]",value:e.size,type:"hidden"})).append($("<input/>",{name:t+"[type]",value:e.type,type:"hidden"})).append($("<input/>",{name:t+"[order]",value:e.order,type:"hidden","data-role":"order"})).append($("<input/>",{name:t+"["+options.baseUrlAttributeName+"]",value:e[options.baseUrlAttribute],type:"hidden"})).append($("<span/>",{"class":"name",title:e.name,text:options.showPreviewFilename?e.name:null})),options.fields){var a=$input.attr("id"),o=$("<div/>",{id:"widget-"+a+"-"+n,"class":"upload-custom-field-group"});for(var r in options.fields){var s=options.fields[r],p=Object.assign({},s),l=void 0===s.tag?"input":s.tag,u=$("<div/>",{"class":"form-group"});p.value=methods.getValue(e,p.name),p.name=t+p.name,u.append($("<label/>").append(p.label)),delete p.tag,delete p.label,u.append($("<"+l+"/>",p)),o.append(u)}i.append(o)}var d=$("<span/>",{"class":"btn-panel"});if(options.buttons)for(var r in options.buttons){var c=options.buttons[r],m=$("<span/>",c);m.data("index",n),m.on(c.events),d.append(m)}else d.append($("<span/>",{"class":"glyphicon glyphicon-remove-circle remove","data-url":e.delete_url}));return i.append(d),e.type&&-1===e.type.search(/image\/.*/g)||!options.previewImage?(i.removeClass("image").addClass("not-image"),i.css("backgroundImage",""),i.find("span.name").text(e.name)):(i.removeClass("not-image").addClass("image"),i.prepend($("<img/>",{src:e[options.baseUrlAttribute]+"/"+e[options.pathAttribute]})),i.find("span.type").text("")),i},checkInputVisibility:function(){var e=$container.find(".upload-kit-input");options.maxNumberOfFiles&&methods.getNumberOfFiles()>=options.maxNumberOfFiles?e.hide():e.show()},handleEmptyValue:function(){methods.getNumberOfFiles()>0?$emptyInput.val(methods.getNumberOfFiles()):$emptyInput.removeAttr("value")},getNumberOfFiles:function(){return $container.find(".files .upload-kit-item").length},getNewItemIndex:function(){var e=[];return $container.find(".files .upload-kit-item").each(function(){e.push($(this).val())}),e.length?Math.max.apply(Math,e)+1:0},updateOrder:function(){$files.find(".upload-kit-item").each(function(e,t){$(t).find("input[data-role=order]").val(e)})}};return methods.init.apply(this),this}}(jQuery);